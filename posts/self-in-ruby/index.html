<!DOCTYPE html>
<html>
  <head>
    <title>
      Self in Ruby |
      Jimmy Cuadra
    </title>
    <link href="/stylesheets/application-58ac5912.css" rel="stylesheet" type="text/css" />
    <link href='http://feeds.feedburner.com/jimmycuadra' rel='alternate' title='RSS' type='application/rss+xml'>
    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-5500916-1');ga('send', 'pageview');</script>
  </head>
  <body>
    <header class='site-header'>
      <div class='bucket'>
        <a class='title-link' href='/' title='Jimmy Cuadra'>
          <img width="75" height="75" alt="Jimmy Cuadra" class="logo" src="/images/logo-3e3e6b15.png" />
          <hgroup>
            <h1 class='main-title'>I'm Jimmy Cuadra.</h1>
            <p>I write about programming and open source software.</p>
          </hgroup>
          <div class='clear'></div>
        </a>
      </div>
    </header>
    <nav>
      <div class='bucket'>
        <ul>
          <li><a title="Writing" href="/">Writing</a></li>
          <li><a class="sub-nav" title="Writing by tags" href="/tags/">by tags</a></li>
          <li><a title="Jimmy Cuadra's Résumé" href="/resume/">Résumé</a></li>
        </ul>
      </div>
    </nav>
    <div class='content'>
      <div class='bucket'>
        <article itemscope itemtype='http://schema.org/BlogPosting'>
          <meta content='Jimmy Cuadra' itemprop='author'>
          <header>
            <h1 class='post-title' itemprop='headline'><a title="Self in Ruby" href="/posts/self-in-ruby/">Self in Ruby</a></h1>
            <data itemprop='datePublished' value='2011-02-02'>February 02, 2011</data>
          </header>
          <div class='social'>
            <div class='g-plus' data-action='share' data-annotation='bubble' data-href='/posts/self-in-ruby/'></div>
            <a class='twitter-share-button' data-count='horizontal' data-text='Self in Ruby' data-url='/posts/self-in-ruby/' data-via='jimmycuadra' href='https://twitter.com/share'>Tweet</a>
          </div>
          <p>The keyword <code>self</code> in Ruby gives you access to the current object – the object that is receiving the current message. To explain: a method call in Ruby is actually the sending of a message to a receiver. When you write <code>obj.meth</code>, you're sending the <code>meth</code> message to the object <code>obj</code>. <code>obj</code> will respond to <code>meth</code> if there is a method body defined for it. And inside that method body, <code>self</code> refers to <code>obj</code>. When I started with Ruby, I learned this pretty quickly, but it wasn't totally apparent when you might actually need to use <code>self</code>. I will outline the two most common use cases I've found for it.</p>
          
          <h2 id="class-methods">Class methods</h2>
          
          <p>The first usage I ran into was to define class methods. Inside a class, the <code>def</code> keyword will create a new instance method, when used without an explicit receiver.</p>
          
          <pre><code class="language-ruby">class Post&#x000A;  attr_writer :title&#x000A;&#x000A;  def print_title&#x000A;    puts "The title of this post is #{@title}"&#x000A;  end&#x000A;end&#x000A;&#x000A;pst = Post.new&#x000A;pst.title = "Green Beans"&#x000A;pst.print_title&#x000A;# "The title of this post is Green Beans"&#x000A;</code></pre>
          
          <p>In the context of a class, <code>self</code> refers to the current class, which is simply an instance of the class <code>Class</code>. Defining a method on <code>self</code> creates a class method.</p>
          
          <pre><code class="language-ruby">class Post&#x000A;  def self.print_author&#x000A;    puts "The author of all posts is Jimmy"&#x000A;  end&#x000A;end&#x000A;&#x000A;Post.print_author&#x000A;# "The author of all posts is Jimmy"&#x000A;</code></pre>
          
          <p>Another more advanced way to do this is to define a method inside the <code>Class</code> instance itself. This is referred to as the eigenclass or the singleton class and it uses the <code>self</code> keyword to open a new context where the <code>Class</code> instance is held in <code>self</code>.</p>
          
          <pre><code class="language-ruby">class Post&#x000A;  class &lt;&lt; self&#x000A;    def print_author&#x000A;      puts "The author of all posts is Jimmy"&#x000A;    end&#x000A;  end&#x000A;end&#x000A;&#x000A;Post.print_author&#x000A;# "The author of all posts is Jimmy"&#x000A;</code></pre>
          
          <h2 id="disambiguation">Disambiguation</h2>
          
          <p>When you call a method without an explicit receiving object, the method is implicitly called on <code>self</code>. So if <code>self</code> is assumed for us, why do we ever need to use <code>self.meth</code> outside of a class method definition? As it turns out, it may not always be clear which method you're trying to call. Consider this example:</p>
          
          <pre><code class="language-ruby">class Post&#x000A;  attr_writer :title&#x000A;&#x000A;  def self.author&#x000A;    "Jimmy"&#x000A;  end&#x000A;&#x000A;  def full_title&#x000A;    "#{@title} by #{class.author}"&#x000A;  end&#x000A;end&#x000A;&#x000A;pst = Post.new&#x000A;pst.title = "Delicious Ham"&#x000A;puts pst.full_title&#x000A;</code></pre>
          
          <p>When we call <code>full_title</code>, we get a syntax error because <code>class.author</code> in the method body attempts to use the <code>class</code> keyword instead of the <code>class</code> method on the <code>pst</code> object, which is what we want – the object's class. If we use <code>self.class.author</code> instead, Ruby knows that we want the <code>class</code> method of <code>pst</code>, and we get the result we expect.</p>
          
          <p>Another time when <code>self</code> is needed for disambiguation is when assigning a value to one of the object's attributes. Here is a contrived example:</p>
          
          <pre><code class="language-ruby">class Post&#x000A;  attr_accessor :title&#x000A;&#x000A;  def replace_title(new_title)&#x000A;    title = new_title&#x000A;  end&#x000A;&#x000A;  def print_title&#x000A;    puts title&#x000A;  end&#x000A;end&#x000A;&#x000A;pst = Post.new&#x000A;pst.title = "Cream of Broccoli"&#x000A;pst.replace_title("Cream of Spinach")&#x000A;pst.print_title&#x000A;# "Cream of Broccoli"&#x000A;</code></pre>
          
          <p>Even though we replaced the title of the post with "Cream of Spinach," it remained set to "Cream of Broccoli" and that's what we see when calling <code>print_title</code>. This is because the assignment inside <code>replace_title</code> is simply assigning to a local variable called <code>title</code> which is not used for anything. If we change that line to <code>self.title = new_title</code>, then the call to <code>print_title</code> at the end will give us "Cream of Spinach" as we were expecting. Note that it is not necessary to use <code>self.title</code> explicitly when using the accessor method inside the definition of <code>print_title</code>, because Ruby will see that there is no local variable with that name and then send <code>self</code> the message <code>title</code>. In the case of assignment, Ruby must assume you want to assign to a local variable, because if it sends the <code>title=</code> message to <code>self</code>, you are left with no way to set a local variable.</p>
          
          <p>If you have more examples of when you might use <code>self</code>, feel free to leave a comment.</p>
          <footer>
            <p>
              This post was tagged with <a title="Writing tagged with ruby" itemprop="keywords" href="/posts/tags/ruby/">ruby</a>.
            </p>
            <p>
              Find more content by <a title="Browse writing by tags" href="/tags/">browsing by tags</a>.
            </p>
          </footer>
        </article>
      </div>
    </div>
    <footer class='site-footer'>
      <div class='bucket'>
        <p>Logo by <a href="http://stephanielucido.com/" title="Stephanie Lucido">Stephanie Lucido</a>.</p>
        <small>
          &copy; 2015 Jimmy Cuadra. All rights reserved.
        </small>
      </div>
    </footer>
    <script src="/javascripts/application-f844c8db.js" type="text/javascript"></script>
    <script>
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/platform.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    (function(d, t) {
      var e = d.createElement(t), s = d.getElementsByTagName(t)[0];
      e.type = 'text/javascript'; e.async = true; e.src = '//platform.twitter.com/widgets.js';
      s.parentNode.insertBefore(e, s);
    })(document, 'script');
    </script>
  </body>
</html>

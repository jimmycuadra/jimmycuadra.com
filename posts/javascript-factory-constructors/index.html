<!DOCTYPE html>
<html>
  <head>
    <title>
      JavaScript factory constructors |
      Jimmy Cuadra
    </title>
    <link href="/stylesheets/application-58ac5912.css" rel="stylesheet" />
    <link href='http://feeds.feedburner.com/jimmycuadra' rel='alternate' title='RSS' type='application/rss+xml'>
    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-5500916-1');ga('send', 'pageview');</script>
  </head>
  <body>
    <header class='site-header'>
      <div class='bucket'>
        <a class='title-link' href='/' title='Jimmy Cuadra'>
          <img width="75" height="75" alt="Jimmy Cuadra" class="logo" src="/images/logo-3e3e6b15.png" />
          <hgroup>
            <h1 class='main-title'>I'm Jimmy Cuadra.</h1>
            <p>I write about programming and open source software.</p>
          </hgroup>
          <div class='clear'></div>
        </a>
      </div>
    </header>
    <nav>
      <div class='bucket'>
        <ul>
          <li><a title="Writing" href="/">Writing</a></li>
          <li><a class="sub-nav" title="Writing by tags" href="/tags/">by tags</a></li>
          <li><a title="Jimmy Cuadra's Résumé" href="/resume/">Résumé</a></li>
        </ul>
      </div>
    </nav>
    <div class='content'>
      <div class='bucket'>
        <article itemscope itemtype='http://schema.org/BlogPosting'>
          <meta content='Jimmy Cuadra' itemprop='author'>
          <header>
            <h1 class='post-title' itemprop='headline'><a title="JavaScript factory constructors" href="/posts/javascript-factory-constructors/">JavaScript factory constructors</a></h1>
            <data itemprop='datePublished' value='2010-03-18'>March 18, 2010</data>
          </header>
          <div class='social'>
            <div class='g-plus' data-action='share' data-annotation='bubble' data-href='/posts/javascript-factory-constructors/'></div>
            <a class='twitter-share-button' data-count='horizontal' data-text='JavaScript factory constructors' data-url='/posts/javascript-factory-constructors/' data-via='jimmycuadra' href='https://twitter.com/share'>Tweet</a>
          </div>
          <p>In JavaScript, a constructor is simply a function. In order to use a function as a constructor, you call it using the <code>new</code> keyword. When you use this keyword, a new instance of the function is created and the constructor function executes in the context of the new instance. In other words, <code>this</code> within the constructor function will refer to the new instance that's being created. The constructor will also implicitly return <code>this</code> (the new instance).</p>
          
          <pre><code class="language-javascript">function Birthday(name) {&#x000A;  this.name = name;&#x000A;}&#x000A;&#x000A;new Birthday('Jimmy'); // creates a new Birthday instance&#x000A;</code></pre>
          
          <p>The above code would create a new instance of <code>Birthday</code>, whose <code>name</code> property would be set to <code>Jimmy</code>. Because the constructor is just a function, it can be called normally, without the <code>new</code> keyword. This can be quite dangerous however, because when <code>new</code> is left out, <code>this</code> will refer to the global object instead of the new <code>Birthday</code> instance you're trying to create.</p>
          
          <pre><code class="language-javascript">function Birthday(name) {&#x000A;  this.name = name;&#x000A;}&#x000A;&#x000A;Birthday('Jimmy'); // assigns a new global variable&#x000A;</code></pre>
          
          <p>In this example, <code>new</code> is not used, so <code>this</code> within the constructor function is the global object and we're assigning the value <code>Jimmy</code> to the global variable, <code>name</code>. It's very unlikely that this is intended, and as with all global variables, it can cause some major headaches. So how can you prevent the constructor function from being used this way accidentally? A solution is to use the constructor as a <strong>factory</strong>, where the constructor itself looks at what is happening and decides what to return. Take a look at this:</p>
          
          <pre><code class="language-javascript">function Birthday(name) {&#x000A;  if (this === window) {&#x000A;    return new Birthday(name);&#x000A;  }&#x000A;&#x000A;  this.name = name;&#x000A;}&#x000A;&#x000A;new Birthday('Jimmy'); // creates a new Birthday instance&#x000A;Birthday('Jimmy'); // also creates a new Birthday instance&#x000A;</code></pre>
          
          <p>As I mentioned, a constructor function will implicitly return <code>this</code>. But that behavior can be overridden by explicitly returning another object. In this case, the constructor function checks to see if it was called in the context of the global object. If it was, it calls itself in the correct context using <code>new</code> and returns the new instance returned by that invocation. If it is not called in the global context, it behaves as it does normally, setting the <code>name</code> property and implicitly returning the new instance. This allows you to call the constructor with or without the <code>new</code> keyword with exactly the same effect.</p>
          <footer>
            <p>
              This post was tagged with <a title="Writing tagged with javascript" itemprop="keywords" href="/posts/tags/javascript/">javascript</a>.
            </p>
            <p>
              Find more content by <a title="Browse writing by tags" href="/tags/">browsing by tags</a>.
            </p>
          </footer>
        </article>
      </div>
    </div>
    <footer class='site-footer'>
      <div class='bucket'>
        <p>Logo by <a href="http://stephanielucido.com/" title="Stephanie Lucido">Stephanie Lucido</a>.</p>
        <small>
          &copy; 2015 Jimmy Cuadra. All rights reserved.
        </small>
      </div>
    </footer>
    <script src="/javascripts/application-f844c8db.js"></script>
    <script>
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/platform.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    (function(d, t) {
      var e = d.createElement(t), s = d.getElementsByTagName(t)[0];
      e.type = 'text/javascript'; e.async = true; e.src = '//platform.twitter.com/widgets.js';
      s.parentNode.insertBefore(e, s);
    })(document, 'script');
    </script>
  </body>
</html>

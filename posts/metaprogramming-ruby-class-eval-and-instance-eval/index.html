<!DOCTYPE html>
<html>
  <head>
    <title>
      Metaprogramming Ruby: class_eval and instance_eval |
      Jimmy Cuadra
    </title>
    <link href="/stylesheets/application-58ac5912.css" rel="stylesheet" type="text/css" />
    <link href='http://feeds.feedburner.com/jimmycuadra' rel='alternate' title='RSS' type='application/rss+xml'>
    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-5500916-1');ga('send', 'pageview');</script>
  </head>
  <body>
    <header class='site-header'>
      <div class='bucket'>
        <a class='title-link' href='/' title='Jimmy Cuadra'>
          <img width="75" height="75" alt="Jimmy Cuadra" class="logo" src="/images/logo-3e3e6b15.png" />
          <hgroup>
            <h1 class='main-title'>I'm Jimmy Cuadra.</h1>
            <p>I write about programming and open source software.</p>
          </hgroup>
          <div class='clear'></div>
        </a>
      </div>
    </header>
    <nav>
      <div class='bucket'>
        <ul>
          <li><a title="Writing" href="/">Writing</a></li>
          <li><a class="sub-nav" title="Writing by tags" href="/tags/">by tags</a></li>
          <li><a title="Jimmy Cuadra's Résumé" href="/resume/">Résumé</a></li>
        </ul>
      </div>
    </nav>
    <div class='content'>
      <div class='bucket'>
        <article itemscope itemtype='http://schema.org/BlogPosting'>
          <meta content='Jimmy Cuadra' itemprop='author'>
          <header>
            <h1 class='post-title' itemprop='headline'><a title="Metaprogramming Ruby: class_eval and instance_eval" href="/posts/metaprogramming-ruby-class-eval-and-instance-eval/">Metaprogramming Ruby: class_eval and instance_eval</a></h1>
            <data itemprop='datePublished' value='2010-10-25'>October 25, 2010</data>
          </header>
          <div class='social'>
            <div class='g-plus' data-action='share' data-annotation='bubble' data-href='/posts/metaprogramming-ruby-class-eval-and-instance-eval/'></div>
            <a class='twitter-share-button' data-count='horizontal' data-text='Metaprogramming Ruby: class_eval and instance_eval' data-url='/posts/metaprogramming-ruby-class-eval-and-instance-eval/' data-via='jimmycuadra' href='https://twitter.com/share'>Tweet</a>
          </div>
          <p>I am currently reading a great book called <a href="http://pragprog.com/titles/ppmetr/metaprogramming-ruby">Metaprogramming Ruby</a>, an in-depth guide to dynamic code and code generation in Ruby. There have been a lot of light bulb moments for me while reading. Sometimes when the book explains a concept or Ruby feature, it sheds light on things I've seen in other people's code – things I've always wondered about. One such example is <code>class_eval</code> and <code>instance_eval</code>. These methods allow you to evaluate arbitrary code in the context of a particular class or object. They're slightly similar to <code>call</code>, <code>apply</code> and <code>bind</code> in JavaScript, in that you are altering the value of <code>self</code> (<code>this</code> in JavaScript) when you use them. Let's take a look at some examples to demonstrate their usage.</p>
          
          <pre><code class="language-ruby">class Person&#x000A;end&#x000A;&#x000A;Person.class_eval do&#x000A;  def say_hello&#x000A;   "Hello!"&#x000A;  end&#x000A;end&#x000A;&#x000A;jimmy = Person.new&#x000A;jimmy.say_hello # "Hello!"&#x000A;</code></pre>
          
          <p>In this example, <code>class_eval</code> allows us to define a method within the <code>Person</code> class outside of its original definition and without reopening the class with the standard syntax. This could be useful when the class you want to add this method to is not known until runtime.</p>
          
          <pre><code class="language-ruby">class Person&#x000A;end&#x000A;&#x000A;Person.instance_eval do&#x000A;  def human?&#x000A;    true&#x000A;  end&#x000A;end&#x000A;&#x000A;Person.human? # true&#x000A;</code></pre>
          
          <p>This example of <code>instance_eval</code> is similar, but evaluates the code in the context of an instance instead of a class. This is confusing at first, because in these examples <code>class_eval</code> creates instance methods and <code>instance_eval</code> creates class methods. There is reason behind the madness, however.</p>
          
          <p><code>class_eval</code> is a method of the <code>Module</code> class, meaning that the receiver will be a module or a class. The block you pass to <code>class_eval</code> is evaluated in the context of that class. Defining a method with the standard <code>def</code> keyword within a class defines an instance method, and that's exactly what happens here.</p>
          
          <p><code>instance_eval</code>, on the other hand, is a method of the <code>Object</code> class, meaning that the receiver will be an object. The block you pass to <code>instance_eval</code> is evaluated in the context of that object. That means that <code>Person.instance_eval</code> is evaluated in the context of the <code>Person</code> <em>object</em>. Remember that a class name is simply a constant which points to an instance of the class <code>Class</code>. Because of this fact, defining a method in the context of <code>Class</code> instance referenced by <code>Person</code> creates a class method for <code>Person</code> class.</p>
          
          <p>It may be difficult to wrap your mind around that if you're not familiar with the Ruby object model, but it's still easy to remember how these methods behave with a simple mnemonic device: when called on a class name constant, these two methods will allow you to create methods of the opposite type from their names. <code>MyClass.class_eval</code> will create instance methods and <code>MyClass.instance_eval</code> will create class methods.</p>
          
          <p>If you're interested in metaprogramming or understanding the Ruby object model, I'd definitely recommend the book. It's helped me out tremendously.</p>
          <footer>
            <p>
              This post was tagged with <a title="Writing tagged with ruby" itemprop="keywords" href="/posts/tags/ruby/">ruby</a>.
            </p>
            <p>
              Find more content by <a title="Browse writing by tags" href="/tags/">browsing by tags</a>.
            </p>
          </footer>
        </article>
      </div>
    </div>
    <footer class='site-footer'>
      <div class='bucket'>
        <p>Logo by <a href="http://stephanielucido.com/" title="Stephanie Lucido">Stephanie Lucido</a>.</p>
        <small>
          &copy; 2015 Jimmy Cuadra. All rights reserved.
        </small>
      </div>
    </footer>
    <script src="/javascripts/application-f844c8db.js" type="text/javascript"></script>
    <script>
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/platform.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    (function(d, t) {
      var e = d.createElement(t), s = d.getElementsByTagName(t)[0];
      e.type = 'text/javascript'; e.async = true; e.src = '//platform.twitter.com/widgets.js';
      s.parentNode.insertBefore(e, s);
    })(document, 'script');
    </script>
  </body>
</html>

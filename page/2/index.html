<!DOCTYPE html>
<html>
  <head>
    <title>
      
      Jimmy Cuadra
    </title>
    <link href="/stylesheets/application-58ac5912.css" rel="stylesheet" type="text/css" />
    <link href='http://feeds.feedburner.com/jimmycuadra' rel='alternate' title='RSS' type='application/rss+xml'>
    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-5500916-1');ga('send', 'pageview');</script>
  </head>
  <body>
    <header class='site-header'>
      <div class='bucket'>
        <a class='title-link' href='/' title='Jimmy Cuadra'>
          <img width="75" height="75" alt="Jimmy Cuadra" class="logo" src="/images/logo-3e3e6b15.png" />
          <hgroup>
            <h1 class='main-title'>I'm Jimmy Cuadra.</h1>
            <p>I write about programming and open source software.</p>
          </hgroup>
          <div class='clear'></div>
        </a>
      </div>
    </header>
    <nav>
      <div class='bucket'>
        <ul>
          <li><a title="Writing" href="/">Writing</a></li>
          <li><a class="sub-nav" title="Writing by tags" href="/tags/">by tags</a></li>
          <li><a title="Jimmy Cuadra's Résumé" href="/resume/">Résumé</a></li>
        </ul>
      </div>
    </nav>
    <div class='content'>
      <div class='bucket'>
        <article itemscope itemtype='http://schema.org/BlogPosting'>
          <meta content='Jimmy Cuadra' itemprop='author'>
          <header>
            <h1 class='post-title' itemprop='headline'><a title="How Lita.io uses the RubyGems and rubygems.org APIs" href="/posts/how-lita-io-uses-the-rubygems-and-rubygems-org-apis/">How Lita.io uses the RubyGems and rubygems.org APIs</a></h1>
            <data itemprop='datePublished' value='2014-01-23'>January 23, 2014</data>
          </header>
          <div class='social'>
            <div class='g-plus' data-action='share' data-annotation='bubble' data-href='/posts/how-lita-io-uses-the-rubygems-and-rubygems-org-apis/'></div>
            <a class='twitter-share-button' data-count='horizontal' data-text='How Lita.io uses the RubyGems and rubygems.org APIs' data-url='/posts/how-lita-io-uses-the-rubygems-and-rubygems-org-apis/' data-via='jimmycuadra' href='https://twitter.com/share'>Tweet</a>
          </div>
          <p>Today I released a brand new website for Lita at <a href="http://www.lita.io/">lita.io</a>. While the site consists primarily of static pages for documentation, it also has a cool feature that takes advantage of a few relatively unknown things in the Ruby ecosystem. That feature is the <a href="http://www.lita.io/plugins">plugins page</a>, an automatically updating list of all Lita plugins that have been published to RubyGems.</p>
          
          <p>Previously, the only directory of Lita plugins was Lita's wiki on GitHub. When someone released a plugin, they'd have to edit the list manually. This was not ideal. It was easy to forget, and required that people knew that the wiki had such a list in the first place. To make an automatically updating list, I had to think about how I could detect Lita plugins out there on the Internet.</p>
          
          <p>I spent some time digging through the rubygems.org source code to see how I might get the information I wanted out of the API. After experimenting with a few things, I discovered an undocumented API: reverse dependencies. You can hit the endpoint <code>/api/v1/gems/GEM_NAME/reverse_dependencies.json</code> and you will get back a list of all gems that depend on the given gem. This was great! Now I had a list of names of all the gems that depend on Lita. It's pretty safe to assume those are all Lita plugins.</p>
          
          <p>This API only returns the names of the gems, however. I also wanted to display a description and the authors' names. This data could be gathered from an additional API request, but there was another piece of information I wanted that couldn't be extracted from the API.</p>
          
          <p>Lita has two types of plugins: adapters and handlers. Adapters allow Lita to connect to a particular chat service, and handlers add new functionality to the robot at runtime; they're the equivalent of Hubot's scripts. I wanted the plugins page to list the plugin type along with the name, author, and link to its page on rubygems.org. To do this, I used another lesser-known feature: RubyGems metadata.</p>
          
          <p>In RubyGems 2.0 or greater, a gem specification can include arbitrary metadata. The metadata consists of a hash assigned to the <code>metadata</code> attribute of a <code>Gem::Specification</code>. The keys and values must all be strings. In Lita 2.7.1, I updated the templates used to generate new Lita plugins so that they automatically included metadata in their gemspecs indicating which type of plugin it is. For example:</p>
          
          <pre><code class="language-ruby">Gem::Specification.new do |spec|&#x000A;  spec.metadata = { "lita_plugin_type" =&gt; "handler" }&#x000A;end&#x000A;</code></pre>
          
          <p>Because Lita requires Ruby 2.0 or greater, which comes with RubyGems 2.0, any Lita plugin can use the metadata attribute. Any plugins created before the generator update in Lita 2.7.1 can still be detected and listed on the plugins page, it just won't list their type.</p>
          
          <p>Now all I had to do was read this information from each plugin gem. Unfortunately, rubygems.org currently has no API that exposes gem metadata, so things got a little tricky. I wrote a script which called <code>gem fetch</code> to download the actual gem files for all the Lita plugins. Once downloaded, running <code>gem spec</code> on the gem file outputs a YAML representation of the gem's specification. In Ruby, loading that YAML with <code>YAML.load</code> returns a <code>Gem::Specification</code>. From there I could simply access the fields I wanted to display, including the type of plugin via <code>spec.metadata["lita_plugin_type"]</code>. This data is then persisted in Postgres. The script runs once a day to get the latest data from RubyGems.</p>
          
          <p>This process could be made much easier and less error-prone if rubygems.org added metadata to the information it exposes over its API. Nevertheless, creating the plugins page for Lita.io was a good challenge and gave me a chance to explore some of the pieces of the RubyGems ecosystem I didn't know existed.</p>
          <footer>
            <p>
              This post was tagged with <a title="Writing tagged with lita" itemprop="keywords" href="/posts/tags/lita/">lita</a> and <a title="Writing tagged with ruby" itemprop="keywords" href="/posts/tags/ruby/">ruby</a>.
            </p>
            <p>
              Find more content by <a title="Browse writing by tags" href="/tags/">browsing by tags</a>.
            </p>
          </footer>
        </article>
        <article itemscope itemtype='http://schema.org/BlogPosting'>
          <meta content='Jimmy Cuadra' itemprop='author'>
          <header>
            <h1 class='post-title' itemprop='headline'><a title="Getting started with Lita" href="/posts/getting-started-with-lita/">Getting started with Lita</a></h1>
            <data itemprop='datePublished' value='2013-08-20'>August 20, 2013</data>
          </header>
          <div class='social'>
            <div class='g-plus' data-action='share' data-annotation='bubble' data-href='/posts/getting-started-with-lita/'></div>
            <a class='twitter-share-button' data-count='horizontal' data-text='Getting started with Lita' data-url='/posts/getting-started-with-lita/' data-via='jimmycuadra' href='https://twitter.com/share'>Tweet</a>
          </div>
          <p><a href="http://lita.io/">Lita</a> is an extendable chat bot for Ruby programmers that can work with any chat service. If you've used Hubot before, Lita is similar, but written in Ruby instead of JavaScript. It's easy to get started, and you can have your own bot running in minutes.</p>
          
          <p>Lita uses regular RubyGems as plugins. You'll need at least one "adapter" gem to connect to the chat service of your choice. Add as many "handler" gems as you want to add functionality to your bot.</p>
          
          <ol>
            <li>
              <p>Install the <em>lita</em> gem.</p>
          
              <pre><code class="language-text">$ gem install lita&#x000A;</code></pre>
            </li>
            <li>
              <p>Create a new Lita project.</p>
          
              <pre><code class="language-text">$ lita new&#x000A;</code></pre>
          
              <p>This will create a new directory called <em>lita</em> with a Gemfile and Lita configuration file.</p>
            </li>
            <li>
              <p>Edit the Gemfile, uncommenting or adding the plugins you want to use. There should be an adapter gem (such as <a href="https://github.com/jimmycuadra/lita-hipchat">lita-hipchat</a> or <a href="https://github.com/jimmycuadra/lita-irc">lita-irc</a>) and as many handler gems as you'd like. For example:</p>
          
              <pre><code class="language-ruby">source "https://rubygems.org"&#x000A;&#x000A;gem "lita"&#x000A;gem "lita-hipchat"&#x000A;gem "lita-karma"&#x000A;gem "lita-google-images"&#x000A;</code></pre>
            </li>
            <li>
              <p>Install all the gems you specified in the Gemfile:</p>
          
              <pre><code class="language-text">$ bundle install&#x000A;</code></pre>
            </li>
            <li>
              <p>Install Redis. On OS X, you can use Homebrew with <code>brew install redis</code>.</p>
            </li>
            <li>
              <p>Test Lita out right in your terminal with the built-in shell adapter.</p>
          
              <pre><code class="language-text">$ bundle exec lita&#x000A;</code></pre>
          
              <p>Type "Lita: help" to get a list of commands available to you.</p>
            </li>
            <li>
              <p>Edit the Lita configuration file to add connection information for the chat service you're using. For example, if you're using the HipChat adapter, it might look something like this:</p>
          
              <pre><code class="language-ruby">Lita.configure do |config|&#x000A;  config.robot.name = "Lita Bot"&#x000A;  config.robot.adapter = :hipchat&#x000A;  config.adapter.jid = "12345_123456@chat.hipchat.com"&#x000A;  config.adapter.password = "secret"&#x000A;  config.adapter.rooms = :all&#x000A;end&#x000A;</code></pre>
          
              <p>You'll want to consult the documentation for whichever adapter you're using for all the configuration options. If you're going to deploy Lita to Heroku, you'll want to add the Redis To Go add on and set <code>config.redis.url = ENV["REDISTOGO_URL"]</code>.</p>
            </li>
            <li>
              <p>Deploy your Lita project anywhere you like. If you're deploying to Heroku, you can use a Procfile like this:</p>
          
              <pre><code class="language-text">web: bundle exec lita&#x000A;</code></pre>
          
              <p>Lita also has built-in support for daemonization if you want to deploy it to your own server.</p>
            </li>
          </ol>
          
          <p>Be sure to visit the <a href="http://lita.io/">Lita</a> home page for lots more information on usage, configuration, and adding your own behavior to your robot!</p>
          <footer>
            <p>
              This post was tagged with <a title="Writing tagged with lita" itemprop="keywords" href="/posts/tags/lita/">lita</a> and <a title="Writing tagged with ruby" itemprop="keywords" href="/posts/tags/ruby/">ruby</a>.
            </p>
            <p>
              Find more content by <a title="Browse writing by tags" href="/tags/">browsing by tags</a>.
            </p>
          </footer>
        </article>
        <article itemscope itemtype='http://schema.org/BlogPosting'>
          <meta content='Jimmy Cuadra' itemprop='author'>
          <header>
            <h1 class='post-title' itemprop='headline'><a title="GuerillaPatch: An interface for monkey patching objects for Ruby 1.9 and 2.0" href="/posts/guerillapatch-an-interface-for-monkey-patching-objects-for-ruby-1-9-and-2-0/">GuerillaPatch: An interface for monkey patching objects for Ruby 1.9 and 2.0</a></h1>
            <data itemprop='datePublished' value='2012-11-02'>November 02, 2012</data>
          </header>
          <div class='social'>
            <div class='g-plus' data-action='share' data-annotation='bubble' data-href='/posts/guerillapatch-an-interface-for-monkey-patching-objects-for-ruby-1-9-and-2-0/'></div>
            <a class='twitter-share-button' data-count='horizontal' data-text='GuerillaPatch: An interface for monkey patching objects for Ruby 1.9 and 2.0' data-url='/posts/guerillapatch-an-interface-for-monkey-patching-objects-for-ruby-1-9-and-2-0/' data-via='jimmycuadra' href='https://twitter.com/share'>Tweet</a>
          </div>
          <p>At RubyConf this week, the first preview of the upcoming Ruby 2.0 was released. One of the new features is <em>refinements</em>, a way of adding new behavior to an object that only takes place within a certain scope. This allows a safer way to extend existing objects without screwing up code that may be depending on the original behavior. A common example of this is ActiveSupport, which adds extensions to many of the core classes. With refinements, these extensions can be added to a refinement module, which can then be "used" in other namespaces without affecting the object globally.</p>
          
          <p>This is a powerful new feature, but I was curious how best to write library code that uses it in a way that is interoperable with Ruby 1.9. I created a gem called <strong>GuerillaPatch</strong> which provides a single interface that will extend an object with a refinement if run under Ruby 2.0, and fall back to simply modifying the class globally if run under 1.9.</p>
          
          <p>Install with <code>gem install guerilla_patch</code>. The <a href="https://github.com/jimmycuadra/guerilla_patch">source code</a> and usage examples are available on GitHub.</p>
          <footer>
            <p>
              This post was tagged with <a title="Writing tagged with ruby" itemprop="keywords" href="/posts/tags/ruby/">ruby</a>.
            </p>
            <p>
              Find more content by <a title="Browse writing by tags" href="/tags/">browsing by tags</a>.
            </p>
          </footer>
        </article>
        <p class='pagination'>
          <span><a rel="prev" href="/">← Previous</a></span>
          <span>Page 2</span>
          <span><a rel="next" href="/page/3/">Next →</a></span>
        </p>
      </div>
    </div>
    <footer class='site-footer'>
      <div class='bucket'>
        <p>Logo by <a href="http://stephanielucido.com/" title="Stephanie Lucido">Stephanie Lucido</a>.</p>
        <small>
          &copy; 2015 Jimmy Cuadra. All rights reserved.
        </small>
      </div>
    </footer>
    <script src="/javascripts/application-f844c8db.js" type="text/javascript"></script>
    <script>
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/platform.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    (function(d, t) {
      var e = d.createElement(t), s = d.getElementsByTagName(t)[0];
      e.type = 'text/javascript'; e.async = true; e.src = '//platform.twitter.com/widgets.js';
      s.parentNode.insertBefore(e, s);
    })(document, 'script');
    </script>
  </body>
</html>
